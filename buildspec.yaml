version: 0.2
env:
  parameter-store:
    dburl: "/database/jdbcurl"
    dbuser: "/database/dbuser"
    dbpassword: "/database/dbpass"

phases:
  install:
    on-failure: ABORT
    runtime-versions:
       python: 3.8
    commands:
      - echo "Installing Flyway ..."
      - sudo wget -qO- https://repo1.maven.org/maven2/org/flywaydb/flyway-commandline/6.5.3/flyway-commandline-6.5.3-linux-x64.tar.gz | tar xvz && sudo ln -s `pwd`/flyway-6.5.3/flyway /usr/local/bin 
  build:
    on-failure: ABORT
    commands:
      - echo "Migrating DB on `date` in `pwd`"
      - flyway migrate -url=$dburl -user=$dbuser -password=$dbpassword
  post_build:
    on-failure: ABORT
    commands:
      - echo "SAM packaging completed on `date`"
artifacts:
  files:
    ./